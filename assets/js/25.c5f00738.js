(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{272:function(t,s,a){"use strict";a.r(s);var n=a(28),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"websocket"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#websocket"}},[t._v("#")]),t._v(" WebSocket")]),t._v(" "),a("p",[t._v("WebSocket实现了双向通信，服务端可以主动发送信息给客户端。在WebSocket中，浏览器和服务器只需要完成一次握手，两者之间就直接可以创建持久性的连接，并进行双向数据传输，客户端和服务器之间的数据交换变得更加简单。")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://html.spec.whatwg.org/multipage/web-sockets.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("web-sockets标准"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/WebSocket",target:"_blank",rel:"noopener noreferrer"}},[t._v("mozilla文档"),a("OutboundLink")],1)])]),t._v(" "),a("h2",{attrs:{id:"websocket使用场景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#websocket使用场景"}},[t._v("#")]),t._v(" WebSocket使用场景")]),t._v(" "),a("ul",[a("li",[t._v("弹幕")]),t._v(" "),a("li",[t._v("在线协同")]),t._v(" "),a("li",[t._v("社交聊天")]),t._v(" "),a("li",[t._v("股票数据更新")]),t._v(" "),a("li",[t._v("实时更新的数据")]),t._v(" "),a("li",[t._v("位置信息更新")])]),t._v(" "),a("h2",{attrs:{id:"websocket接口"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#websocket接口"}},[t._v("#")]),t._v(" WebSocket接口")]),t._v(" "),a("div",{staticClass:"language-ts line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-ts"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("enum")]),t._v(" BinaryType "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"blob"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"arraybuffer"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Exposed"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("Worker"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("WebSocket")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" EventTarget "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("constructor")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("USVString url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("optional")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("DOMString or sequence"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("DOMString"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" protocols "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("readonly")]),t._v(" attribute USVString url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ready state状态")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" unsigned short "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("CONNECTING")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" unsigned short "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("OPEN")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" unsigned short "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("CLOSING")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" unsigned short "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("CLOSED")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("readonly")]),t._v(" attribute unsigned short readyState"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("readonly")]),t._v(" attribute unsigned long long bufferedAmount"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// networking")]),t._v("\n  attribute EventHandler onopen"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  attribute EventHandler onerror"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  attribute EventHandler onclose"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("readonly")]),t._v(" attribute DOMString extensions"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("readonly")]),t._v(" attribute DOMString protocol"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("close")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("optional "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Clamp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" unsigned short code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" optional USVString reason"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// messaging")]),t._v("\n  attribute EventHandler onmessage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  attribute BinaryType binaryType"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("send")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("USVString data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("send")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Blob data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("send")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ArrayBuffer data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("send")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ArrayBufferView data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br"),a("span",{staticClass:"line-number"},[t._v("25")]),a("br"),a("span",{staticClass:"line-number"},[t._v("26")]),a("br"),a("span",{staticClass:"line-number"},[t._v("27")]),a("br"),a("span",{staticClass:"line-number"},[t._v("28")]),a("br"),a("span",{staticClass:"line-number"},[t._v("29")]),a("br"),a("span",{staticClass:"line-number"},[t._v("30")]),a("br"),a("span",{staticClass:"line-number"},[t._v("31")]),a("br")])]),a("h3",{attrs:{id:"websocket构造函数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#websocket构造函数"}},[t._v("#")]),t._v(" WebSocket构造函数")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 返回一个 WebSocket 对象")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" socket "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("WebSocket")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("protocols"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br")])]),a("p",[t._v("url参数的格式")]),t._v(" "),a("ul",[a("li",[t._v('ws-URI = "ws:" "//" host [ ":" port ] path [ "?" query ]')]),t._v(" "),a("li",[t._v('wss-URI = "wss:" "//" host [ ":" port ] path [ "?" query ]')])]),t._v(" "),a("h3",{attrs:{id:"属性"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#属性"}},[t._v("#")]),t._v(" 属性")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("url "),a("strong",[t._v("只读")]),t._v(" 数创建WebSocket实例对象时URL的绝对路径。")])]),t._v(" "),a("li",[a("p",[t._v("readyState "),a("strong",[t._v("只读")])]),t._v(" "),a("p",[t._v("当前连接的状态")]),t._v(" "),a("ul",[a("li",[t._v("WebSocket.CONNECTING = 0 尚未建立连接")]),t._v(" "),a("li",[t._v("WebSocket.OPRN = 1 连接已建立，可以进行通信")]),t._v(" "),a("li",[t._v("WebSocket.CLOSING = 2 连接正在进行关闭握手，或者已调用close（）方法。")]),t._v(" "),a("li",[t._v("WebSocket.CLOSED = 3 连接已关闭或无法打开")])])]),t._v(" "),a("li",[a("p",[t._v("bufferedAmount "),a("strong",[t._v("只读")])])]),t._v(" "),a("li",[a("p",[t._v("onopen 打开与WebSocket的连接时触发的回掉函数")])]),t._v(" "),a("li",[a("p",[t._v("onerror 当由于错误而关闭与WebSocket的连接（例如无法发送某些数据）时触发。")])]),t._v(" "),a("li",[a("p",[t._v("onclose 与WebSocket的连接关闭时触发")])]),t._v(" "),a("li",[a("p",[t._v("extensions "),a("strong",[t._v("只读")])])]),t._v(" "),a("li",[a("p",[t._v("protocol "),a("strong",[t._v("只读")])])]),t._v(" "),a("li",[a("p",[t._v("onmessage 通过WebSocket接收数据时触发")])]),t._v(" "),a("li",[a("p",[t._v("binaryType websocket连接所传输二进制数据的类型")])])]),t._v(" "),a("h3",{attrs:{id:"方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#方法"}},[t._v("#")]),t._v(" 方法")]),t._v(" "),a("h4",{attrs:{id:"close-code-reason"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#close-code-reason"}},[t._v("#")]),t._v(" close(code, reason)")]),t._v(" "),a("p",[t._v("code为关闭的"),a("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/CloseEvent#Status_codes",target:"_blank",rel:"noopener noreferrer"}},[t._v("状态码"),a("OutboundLink")],1),t._v(",默认为1005")]),t._v(" "),a("p",[t._v("reason为关闭的原因字符串")]),t._v(" "),a("h4",{attrs:{id:"send-data"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#send-data"}},[t._v("#")]),t._v(" send(data)")]),t._v(" "),a("ul",[a("li",[t._v("data是字符串")]),t._v(" "),a("li",[t._v("data是Blob对象")]),t._v(" "),a("li",[t._v("data是ArrayBuffer对象")]),t._v(" "),a("li",[t._v("data是ArrayBufferView")])]),t._v(" "),a("h3",{attrs:{id:"关闭连接"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#关闭连接"}},[t._v("#")]),t._v(" 关闭连接")]),t._v(" "),a("p",[t._v("客户端和服务端都可主动关闭")]),t._v(" "),a("h2",{attrs:{id:"websocket库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#websocket库"}},[t._v("#")]),t._v(" WebSocket库")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://github.com/socketio/socket.io",target:"_blank",rel:"noopener noreferrer"}},[t._v("socket.io"),a("OutboundLink")],1),t._v(" 一个基于长轮询/WebSocket的Node.js第三方传输协议。")]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/websockets/ws",target:"_blank",rel:"noopener noreferrer"}},[t._v("ws"),a("OutboundLink")],1),t._v(" 一个流行的WebSocket客户端和服务器 Node.js库。")])])])}),[],!1,null,null,null);s.default=e.exports}}]);